<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <link rel="stylesheet" href="js/dygraph.css">
    <script type="text/javascript" src="js/dygraph.min.js"></script>
  </head>

  <body>
    <div class="col-lg-8">
      <div id="demodiv"></div>
    </div>
    <input type="button" id="temp_up" value="+" />
    <input type="button" id="temp_down" value="-" />

    <script type="text/javascript">
        var get_data = function(handler) {
            $.getJSON("data", function(raw_data) {
                var data = []
                var len = raw_data.temperature.length;
                for (var i = 0; i < len; i++) {
                    var one = raw_data.temperature[i];
                    var date = new Date(one.date);
                    data.push([date, one.temp, one.target_temp]);
                }
                handler(data);
            });
        };

        var g
        get_data(function(data) {
            g = new Dygraph(
                document.getElementById("demodiv"),
                data,
                {
                    labels: ['Time', 'Temp', 'Target'],
                    animatedZooms: true
                });
        });

        setInterval(function() {
            get_data(function(data) {
                g.updateOptions( { 'file': data } );
            });
        }, 1000);

        var temp_adj = function(dir) {
            $.get("temp_adj/"+dir);
        };

        $('#temp_up').click(function() {
            temp_adj('up');
        });

        $('#temp_down').click(function() {
            temp_adj('down');
        });

    </script>

    </script>
  <body>
</html>
